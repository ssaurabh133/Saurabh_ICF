/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.gcd.actions;

import java.util.ArrayList;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import org.apache.log4j.Logger;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.actions.DispatchAction;

import com.connect.DaoImplInstanceFactory;
import com.gcd.dao.CorporateDAO;
import com.login.dao.UserSessionCheck;
import com.login.roleManager.UserObject;

/** 
 * MyEclipse Struts
 * Creation date: 02-21-2011
 * 
 * XDoclet definition:
 * @struts.action input="/JSP/gcdJSP/Maker.jsp" parameter="method" scope="request" validate="true"
 */
public class ShowCustomerDetailAction extends DispatchAction {
	private static final Logger logger = Logger.getLogger(ShowCustomerDetailAction.class.getName());
	/*
	 * Generated Methods
	 */

	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward getCustomerDetail(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)throws Exception {
	
		logger.info("In ShowCustomerDetailAction into getCustomerDetail");
		String codeId = request.getParameter("codeId").trim();
		String customerName = request.getParameter("customerName").trim();
		
		    HttpSession session = request.getSession();
			UserObject userobj=(UserObject)session.getAttribute("userobject");
			
			Object sessionId = session.getAttribute("sessionID");
			ServletContext context = getServlet().getServletContext();
			String strFlag="";	
			if(sessionId!=null)
			{
				strFlag = UserSessionCheck.checkSameUserSession(userobj,sessionId.toString(),"",request);
			}
			
			logger.info("strFlag .............. "+strFlag);
			if(!strFlag.equalsIgnoreCase(""))
			{
				if(strFlag.equalsIgnoreCase("sameUserSession"))
				{
					context.removeAttribute("msg");
					context.removeAttribute("msg1");
				}
				else if(strFlag.equalsIgnoreCase("BODCheck"))
				{
					context.setAttribute("msg", "B");
				}
				return mapping.findForward("logout");
			}
		
		
		session.setAttribute("corporateId", codeId);
		session.setAttribute("idividualId", codeId);
		
		CorporateDAO cust=(CorporateDAO)DaoImplInstanceFactory.getDaoImplInstance(CorporateDAO.IDENTITY);
		logger.info("Implementation class: "+cust.getClass());
		String recStatus="";
		String statusCase="";
		String pageStatus="";
		boolean check=true;
		if(session.getAttribute("approve")!=null)
		{
			pageStatus = session.getAttribute("approve").toString();
		}
		recStatus=request.getParameter("recStatus");
		if(recStatus==null)
			recStatus ="";
		if(recStatus.trim().equalsIgnoreCase("A"))
		{
			if(request.getParameter("statusCase")!=null)
			{
				session.setAttribute("statusCase", request.getParameter("statusCase"));
				statusCase = request.getParameter("statusCase");
				if(request.getParameter("statusCase").equals("Approved"))
				{
					if(!codeId.trim().equalsIgnoreCase(""))
					check = cust.checkGoForApproval(codeId);
				}
			}			
		}
		else
		{
			session.removeAttribute("statusCase");
			statusCase="";
		}
		logger.info("check....................................... "+check);
		if(check==true)
		{
			int currentPageLink = 0;
			if(recStatus.trim().equalsIgnoreCase("PC"))
			{
				logger.info("current page link .......... "+request.getParameter("d-1639197-p"));		
				if(request.getParameter("d-1639197-p")==null || request.getParameter("d-1639197-p").equalsIgnoreCase("0"))
					currentPageLink=1;
				else
					currentPageLink =Integer.parseInt(request.getParameter("d-1639197-p"));
				logger.info("current page link ................ "+request.getParameter("d-1639197-p"));
			}
			if(recStatus.trim().equalsIgnoreCase("PI"))
			{
				logger.info("current page link .......... "+request.getParameter("d-532354-p"));		
				if(request.getParameter("d-532354-p")==null || request.getParameter("d-532354-p").equalsIgnoreCase("0"))
					currentPageLink=1;
				else
					currentPageLink =Integer.parseInt(request.getParameter("d-532354-p"));
				logger.info("current page link ................ "+request.getParameter("d-532354-p"));
			}
			if(recStatus.trim().equalsIgnoreCase("A"))
			{
				logger.info("current page link .......... "+request.getParameter("d-8285541-p"));		
				if(request.getParameter("d-8285541-p")==null || request.getParameter("d-8285541-p").equalsIgnoreCase("0"))
					currentPageLink=1;
				else
					currentPageLink =Integer.parseInt(request.getParameter("d-8285541-p"));
				logger.info("current page link ................ "+request.getParameter("d-8285541-p"));
			}
			ArrayList<Object> customer_detail = cust.getCustomerDetailList(codeId, customerName,pageStatus,recStatus,statusCase,currentPageLink);
			if(recStatus.trim().equalsIgnoreCase("PC"))
				request.setAttribute("copoCustomer_detail",customer_detail);
			if(recStatus.trim().equalsIgnoreCase("PI"))
				request.setAttribute("indiCustomer_detail",customer_detail);
			if(recStatus.trim().equalsIgnoreCase("A"))
				request.setAttribute("updateMaker",customer_detail);
			if(customer_detail.size()>0)
			{				
			    session.removeAttribute("addressInfo");
			    session.setAttribute("recStatus", recStatus);
			}
			else
			{
				session.removeAttribute("recStatus");
				mapping.getInputForward();
			}
			
		}
		else
		{
			request.setAttribute("status","");
			request.setAttribute("sms","forApprove");
			
			mapping.getInputForward();
		}
		return mapping.getInputForward();
		
	}
}