/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.masters.actions;

import java.util.ArrayList;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.log4j.Logger;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.actions.DispatchAction;
import org.apache.struts.validator.DynaValidatorForm;

import com.business.ejbClient.CommonMasterBussinessSessionBeanRemote;
import com.connect.CommonFunction;
import com.connect.LookUpInstanceFactory;
import com.login.dao.UserSessionCheck;
import com.login.roleManager.UserObject;
import com.masters.vo.ConsortiumPartnerVo;


/** 
 * MyEclipse Struts
 * Creation date: 05-21-2011
 * 
 * XDoclet definition:
 * @struts.action validate="true"
 */
public class ConsortiumPartnerDispatchAction extends DispatchAction {
	private static final Logger logger = Logger.getLogger(ConsortiumPartnerDispatchAction.class.getName());
	 public ActionForward openAddConsortiumPartner(ActionMapping mapping, ActionForm form,
				HttpServletRequest request, HttpServletResponse response)	throws Exception
				{ServletContext context = getServlet().getServletContext();
					logger.info(" in openAddConsortiumPartner()");
					HttpSession session = request.getSession();
					boolean flag=false;
					UserObject userobj=(UserObject)session.getAttribute("userobject");
					Object sessionId = session.getAttribute("sessionID");
					//for check User session start
					String strFlag="";	
					if(sessionId!=null)
					{
						strFlag = UserSessionCheck.checkSameUserSession(userobj,sessionId.toString(),"",request);
					}
					
					logger.info("strFlag .............. "+strFlag);
					if(!strFlag.equalsIgnoreCase(""))
					{
						if(strFlag.equalsIgnoreCase("sameUserSession"))
						{
							context.removeAttribute("msg");
							context.removeAttribute("msg1");
						}
						else if(strFlag.equalsIgnoreCase("BODCheck"))
						{
							context.setAttribute("msg", "B");
						}
						return mapping.findForward("logout");
					}
					request.setAttribute("save", "save");
					//request.setAttribute("status","Active");
				    return mapping.findForward("openAdd");	
				}
		 

			public ActionForward saveConsortiumPartnerDetails(ActionMapping mapping, ActionForm form,
				HttpServletRequest request, HttpServletResponse resopnse) throws Exception{
				ServletContext context = getServlet().getServletContext();
				//HttpSession session=request.getSession(false);
				HttpSession session = request.getSession();
				boolean flag=false;
				UserObject userobj=(UserObject)session.getAttribute("userobject");
				Object sessionId = session.getAttribute("sessionID");
				//for check User session start
				String strFlag="";	
				if(sessionId!=null)
				{
					strFlag = UserSessionCheck.checkSameUserSession(userobj,sessionId.toString(),"",request);
				}
				
				logger.info("strFlag .............. "+strFlag);
				if(!strFlag.equalsIgnoreCase(""))
				{
					if(strFlag.equalsIgnoreCase("sameUserSession"))
					{
						context.removeAttribute("msg");
						context.removeAttribute("msg1");
					}
					else if(strFlag.equalsIgnoreCase("BODCheck"))
					{
						context.setAttribute("msg", "B");
					}
					return mapping.findForward("logout");
				}
				String userId="";
				String bDate="";
				if(userobj!=null)
				{
						userId=userobj.getUserId();
						bDate=userobj.getBusinessdate();
				}
			DynaValidatorForm ConsortiumPartnerAddDyanavalidatiorForm= (DynaValidatorForm)form;
			ConsortiumPartnerVo vo = new ConsortiumPartnerVo();
			vo.setMakerId(userId);
			vo.setMakerDate(bDate);

		logger.info("consortiumStatus::::::::"+vo.getConsortiumPartnerStatus());
		
			org.apache.commons.beanutils.BeanUtils.copyProperties(vo, ConsortiumPartnerAddDyanavalidatiorForm);	
			
			CommonMasterBussinessSessionBeanRemote bp = (CommonMasterBussinessSessionBeanRemote) LookUpInstanceFactory.getLookUpInstance(CommonMasterBussinessSessionBeanRemote.REMOTE_IDENTITY, request);
			
	        String sms="";
		
			boolean status = bp.insertConsortiumData(vo);
			logger.info("Inside consortium partner Action.....displaying status...."+status);
			if(status){
				sms="SC";
				request.setAttribute("sms",sms);
				request.setAttribute("save", "save");
			}
			else{
				sms="E";
				request.setAttribute("sms",sms);
				request.setAttribute("save", "save");
			}
			logger.info("status"+status);
			form.reset(mapping, request);
			return mapping.findForward("success")/*mapping.getInputForward()*/;
		}
		
		
		
			public ActionForward openEditConsortiumPartner(ActionMapping mapping, ActionForm form,
					HttpServletRequest request, HttpServletResponse response)	throws Exception {
							
				ConsortiumPartnerVo consortiumPartnerVo=new ConsortiumPartnerVo(); 
								logger.info("In openEditConsortiumPartner");
								ServletContext context = getServlet().getServletContext();
								HttpSession session = request.getSession();
								boolean flag=false;
								UserObject userobj=(UserObject)session.getAttribute("userobject");
								Object sessionId = session.getAttribute("sessionID");
								//for check User session start
								String strFlag="";	
								if(sessionId!=null)
								{
									strFlag = UserSessionCheck.checkSameUserSession(userobj,sessionId.toString(),"",request);
								}
								
								logger.info("strFlag .............. "+strFlag);
								if(!strFlag.equalsIgnoreCase(""))
								{
									if(strFlag.equalsIgnoreCase("sameUserSession"))
									{
										context.removeAttribute("msg");
										context.removeAttribute("msg1");
									}
									else if(strFlag.equalsIgnoreCase("BODCheck"))
									{
										context.setAttribute("msg", "B");
									}
									return mapping.findForward("logout");
								}
								
								consortiumPartnerVo.setConsortiumPartnerId(request.getParameter("consortiumPartnerId"));
								logger.info("In openEditConsortiumPartner---status---- by getpara-"+request.getParameter("consortiumPartnerId"));  
								logger.info("In openEditConsortiumPartner---status---- by getpara by vo-"+consortiumPartnerVo.getConsortiumPartnerId());
								
								CommonMasterBussinessSessionBeanRemote bp = (CommonMasterBussinessSessionBeanRemote) LookUpInstanceFactory.getLookUpInstance(CommonMasterBussinessSessionBeanRemote.REMOTE_IDENTITY, request);
						        
						        ArrayList list = bp.searchConsortiumData(consortiumPartnerVo);
								logger.info("In openEditConsortiumPartner ConsortiumPartnerVo list"+list.size());
								request.setAttribute("list", list);
							
								
								consortiumPartnerVo=(ConsortiumPartnerVo) list.get(0);
								ConsortiumPartnerVo docVo=new ConsortiumPartnerVo();
								docVo=(ConsortiumPartnerVo) list.get(0);
								logger.info("In openEditRegion---status---- by   getpara by vo-"+docVo.getConsortiumStatus());
								
								logger.info("In openEditRegion---status---- by   aman by vo-"+docVo.getConsortiumPartnerStatus());
								
							
								request.setAttribute("status", consortiumPartnerVo.getConsortiumPartnerStatus());
								request.setAttribute("editVal", "editVal");
							   return mapping.findForward("editConsortium");	
							}
					
					
					public ActionForward updateConsortiumPartner(ActionMapping mapping, ActionForm form,
							HttpServletRequest request, HttpServletResponse response) throws Exception {
						
						logger.info("In updateConsortiumPartner.......");
						ServletContext context = getServlet().getServletContext();
						HttpSession session = request.getSession();
						boolean flag=false;
						UserObject userobj=(UserObject)session.getAttribute("userobject");
						Object sessionId = session.getAttribute("sessionID");
						//for check User session start
						String strFlag="";	
						if(sessionId!=null)
						{
							strFlag = UserSessionCheck.checkSameUserSession(userobj,sessionId.toString(),"",request);
						}
						
						logger.info("strFlag .............. "+strFlag);
						if(!strFlag.equalsIgnoreCase(""))
						{
							if(strFlag.equalsIgnoreCase("sameUserSession"))
							{
								context.removeAttribute("msg");
								context.removeAttribute("msg1");
							}
							else if(strFlag.equalsIgnoreCase("BODCheck"))
							{
								context.setAttribute("msg", "B");
							}
							return mapping.findForward("logout");
						}
						ConsortiumPartnerVo ConsortiumPartnerVo=new ConsortiumPartnerVo(); 
						DynaValidatorForm ConsortiumPartnerAddDyanavalidatiorForm= (DynaValidatorForm)form;
						org.apache.commons.beanutils.BeanUtils.copyProperties(ConsortiumPartnerVo, ConsortiumPartnerAddDyanavalidatiorForm);	

					//String consortiumPartnerStatus=CommonFunction.checkNull(request.getAttribute("stat"));
					logger.info("In consortiumPartnerStatus---------"+ConsortiumPartnerVo.getConsortiumPartnerStatus());   
						logger.info("In updateConsortiumPartnerDetails---------");    
						
						CommonMasterBussinessSessionBeanRemote bp = (CommonMasterBussinessSessionBeanRemote) LookUpInstanceFactory.getLookUpInstance(CommonMasterBussinessSessionBeanRemote.REMOTE_IDENTITY, request);
//						ConsortiumPartnerVo.setConsortiumPartnerId(request.getParameter("consortiumPartnerId").toString());
				        boolean status=bp.updateConsortiumData(ConsortiumPartnerVo);
				        String sms="";
				        if(status){
				        	sms="M";
							request.setAttribute("sms",sms);
							request.setAttribute("editValUpdate", "editValUpdate");
						}
						else{
							sms="E";
							request.setAttribute("sms",sms);
							ArrayList<ConsortiumPartnerVo> list =new ArrayList<ConsortiumPartnerVo>();
							list.add(ConsortiumPartnerVo);
							logger.info("In updateConsortiumData list"+ list.size());
							
							request.setAttribute("editValUpdate", "editValUpdate");
							request.setAttribute("list", list);
							request.setAttribute("status", ConsortiumPartnerVo.getConsortiumPartnerStatus());
							//request.setAttribute("status", ConsortiumPartnerVo.getConsortiumPartnerId());
							
						}
//				        regionMastervo.setRegionId(request.getParameter("RegionId"));
//						logger.info("In updateRegiontDetails---status-----"+regionMastervo.getRegionStatus());
//						logger.info("in updateRegionDetails ------description-------"+regionMastervo.getRegionDes());
						        
				        return   mapping.getInputForward();
				      
						
					}
					
	}